<html>
   <title>MTA-RDE</title>
   <link rel="icon" type="image/x-icon" href="images/favicon.ico">
   <head>
     <link rel="stylesheet" href="style.css">
   </head>

   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">
     google.charts.load('current', {'packages':['table', 'corechart', 'bar']});
   </script>

   <body style="font-family: Arial, Helvetica, sans-serif;">

   <button onclick="topFunction()" id="topButton" title="Go to top">Top</button>

   <h2>MyTrueAncestry - Raw Data Extractor</h3>
   <button onclick="helpEnFunction()">Help (En)</button>
   <button onclick="helpHuFunction()">Help (Hu)</button>
   <button onclick="optionsFunction()" id="viewOptionsButton" disabled="true">View</button>
   <button onClick="window.open('https://github.com/khelmric/mta-rde');"> 
     <span>Code Repo on Github</span>
   </button>

   <div id="helpEn" style="display:none">
     <section class="fieldset">
       <h1>How to use</h1>
       <ol>
         <li>Login to <a href="https://mytrueancestry.com">https://mytrueancestry.com</a>.</li>
         <li>Select one Kit. (If All Kits are selected only the first will be investigated.)</li>
         <li>Save the webpage in html format.</li>
         <li>On the <a href="http://oci.atomx.hu/mta-rde">http://oci.atomx.hu/mta-rde</a> select the html file(s). 
           (Selecting the second file allows a comparsion of two results.)</li>
       </ol>   
     </section>
   </div>
   <div id="helpHu" style="display:none">
     <section class="fieldset">
       <h1>Használati útmutató</h1>
       <ol>
         <li>Jelentkezz be a <a href="https://mytrueancestry.com">https://mytrueancestry.com</a> oldalra.</li>
         <li>Válassz ki egy Kit-et. Az összes Kit kijelölése esetén csak az elsőt vizsgálja a program.</li>
         <li>Mentsd le a weboldalt html formátumban.</li>
         <li>A <a href="http://oci.atomx.hu/mta-rde">http://oci.atomx.hu/mta-rde</a> oldalon válaszd ki a html fájlt/fájlokat. 
           (A második fájl kiválasztásával összehasonlítható két különböző eredmény.)</li>
       </ol>
     </section>
   </div>
   <div id="viewOptions" style="display:none">
         <br>
         <section class="fieldset">
           <h2>Results</h2>
             <input type="checkbox" id="asb-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showAsb">Ancient Samples Full Breakdown</label><br>
             <input type="checkbox" id="dd-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showDd">Deep Dive Full Breakdown</label><br>
             <input type="checkbox" id="canc-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showCant">Closest Ancient Populations</label><br>
             <input type="checkbox" id="cmod-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showCmod">Closest Modern Populations</label><br>
             <input type="checkbox" id="ydna-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showYdna">Y-DNA Breakdown</label><br>
             <input type="checkbox" id="mtdna-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showMtdna">mtDNA Breakdown</label><br>
             <input type="checkbox" id="sm-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showSm">The Closest Archaeogenetic matches</label><br>
             <input type="checkbox" id="ddar-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showDdar">Deep Dive - Ancient Relatives</label><br>
             <input type="checkbox" id="haploexp-block" onchange="toggleByClass(this)" checked="true" />
             <label for="showHaploexp">All Samples</label><br>
         </section>
         <br>
         <section class="fieldset">
           <h2>Fields</h2>
             <input type="checkbox" id="dl-button" onchange="toggleByClass(this)" checked="true" />
             <label for="showCharts">Buttons</label><br>
             <input type="checkbox" id="result-chart" onchange="toggleByClass(this)" checked="true" />
             <label for="showCharts">Charts</label><br>
             <input type="checkbox" id="result-table" onchange="toggleByClass(this)" checked="true" />
             <label for="showTables">Tables</label><br>
             <input type="checkbox" id="comparison-row" onchange="toggleByClass(this)" checked="true" />
             <label for="showComparison">Comparison</label><br>
         </section>
   </div>

  <script>
  //Get the button
  var mybutton = document.getElementById("topButton");

  window.onscroll = function() {scrollFunction()};

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      mybutton.style.display = "block";
    } else {
      mybutton.style.display = "none";
    }
  }

  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }
  </script>


   <script>
     var arrayAsb1;
     var arrayDd1;
     var arrayYdna1;
     var arrayMtdna1;
     var arrayAsb2;
     var arrayDd2;
     var arrayYdna2;
     var arrayMtdna2;

     function helpHuFunction() {
       var divhelphu = document.getElementById("helpHu");
       var divhelpen = document.getElementById("helpEn");
       var divViewOptions = document.getElementById("viewOptions");
       if (divhelphu.style.display === "none") {
         divhelphu.style.display = "block";
         divViewOptions.style.display = "none";
         divhelpen.style.display = "none"
       } else {
         divhelphu.style.display = "none";
       }
     }
     function helpEnFunction() {
       var divhelphu = document.getElementById("helpHu");
       var divhelpen = document.getElementById("helpEn");
       var divViewOptions = document.getElementById("viewOptions");
       if (divhelpen.style.display === "none") {
         divhelpen.style.display = "block";
         divViewOptions.style.display = "none";
         divhelphu.style.display = "none"
       } else {
         divhelpen.style.display = "none";
       }
     }
     function optionsFunction() {
       var divhelphu = document.getElementById("helpHu");
       var divhelpen = document.getElementById("helpEn");
       var divViewOptions = document.getElementById("viewOptions");
       if (divViewOptions.style.display === "none") {
         divViewOptions.style.display = "block";
         divhelpen.style.display = "none";
         divhelphu.style.display = "none"
       } else {
         divViewOptions.style.display = "none";
       }
     }

    function toggleByClass(checkbox) {
      var displaySetting = "";
      if (checkbox.checked) {
        displaySetting = "block";
      } else {
        displaySetting = "none";
      }
      var targets = document.getElementsByClassName(checkbox.id);
      for(var i = 0; i < targets.length; ++i){
        targets[i].style.display = displaySetting;
      }
    }

    function chartDataTransform(textContent, mREGEX, sREGEX) {
      textContent = textContent.match(mREGEX);
      textContent = String(textContent);
      textContent = textContent.match(sREGEX);
      textContent = String(textContent);
      REGEX = /\"\s?\,\s?\"/g;
      textContent = textContent.replace(REGEX, ',');
      textContent = String(textContent);
      REGEX = /[\s\S]*?\[|\]|\"/g;
      textContent = textContent.replace(REGEX, '');
      textContent = String(textContent);
      return textContent;
    }

    function listSmallDataTransform(textContent, mREGEX, sREGEX1, sREGEX2, sREGEX3, sREGEX4, sREGEX5) {
      textContent = textContent.match(mREGEX);
      textContent = String(textContent);
      textContent = textContent.replace(/\s+\+\s+/g, '+');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX1, '');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX2, ';');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX3, ',');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX4, ' ');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX5, '');
      textContent = String(textContent);
      return textContent;
    }  

    function listDataTransform(textContent, matchNo, mREGEX, sREGEX1, sREGEX2, sREGEX3, sREGEX4, sREGEX5, sREGEX6) {
      textContent = textContent.match(mREGEX);
      textContent = String(textContent[matchNo]);
      textContent = textContent.matchAll(sREGEX1);
      textContent = Array.from(textContent);
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX2, '');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX3, ';');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX4, ',');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX5, '');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX6, ',');
      textContent = String(textContent);
      return textContent;
    }

    function listBigDataTransform(textContent, mREGEX, sREGEX1, sREGEX2, sREGEX3, sREGEX4, sREGEX5) {
      textContent = textContent.match(mREGEX);
      textContent = String(textContent);
      textContent = textContent.match(sREGEX1);
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX2, '');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX3, '');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX4, '');
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX5, ',');
      textContent = String(textContent);
      return textContent;
    }

    function getKitData(textContent, target, mREGEX, sREGEX1) {
      textContent = textContent.match(mREGEX);
      textContent = String(textContent);
      textContent = textContent.replace(sREGEX1, '');
      textContent = String(textContent);
      kitContent = textContent.split('"');
      targetNameDiv = document.getElementById(target + '_name');
      targetNumberDiv = document.getElementById(target + '_number');
      targetNameDiv.innerHTML = kitContent[1];
      targetNumberDiv.innerHTML = kitContent[0];
      return kitContent[0];
    }

    function getKitDate(textContent, kitNumber, target) {
      var mREGEX = new RegExp('info_[\\S]*?_' + kitNumber + '[\\s\\S]*?Processed[\\s\\S]*?\\)', "");
      textContent = textContent.match(mREGEX);
      textContent = String(textContent);
      textContent = textContent.replace(/[\s\S]*?Processed/, '');
      textContent = String(textContent);
      textContent = textContent.replace(/\([\s\S]*?\)/, '');
      textContent = String(textContent);
      targetDiv = document.getElementById(target + '_date');
      targetDiv.innerHTML = textContent;
    }

    function printChartAsTable(textContent, mainREGEX, subREGEX1, subREGEX2, subREGEX3, target, col) {

      var dataArray = [];

      chartLabels = chartDataTransform(textContent, mainREGEX, subREGEX1);
      chartLabelArray = chartLabels.split(',');

      targetDiv = target + col;
      tableDivId = document.getElementById(targetDiv + '_result');
      chart1DivId = document.getElementById(targetDiv + '_chart1');
      buttonsDivId = document.getElementById(targetDiv + '_buttons');

      chartData = chartDataTransform(textContent, mainREGEX, subREGEX2);
      chartDataArray = chartData.split(',');

      chartBgColor = chartDataTransform(textContent, mainREGEX, subREGEX3);
      chartBgColorArray = chartBgColor.split(',');
      var data = new google.visualization.DataTable();

      data.addColumn('string', 'Description');
      data.addColumn('number', 'Value');
      data.addColumn('string', 'Color');

      for (var i = 0; i < chartLabelArray.length; i++) {
        var dataValueAsInt = chartDataArray[i].replace(/\s?/g, '');
        if ( dataValueAsInt.search( /\./ ) == 2) {
          dataValueAsInt = dataValueAsInt + '0';
        }
        dataValueAsInt = parseInt(dataValueAsInt.replace(/\./, ''));

        dataArray[i] = [];
        dataArray[i][0] = chartLabelArray[i];
        dataArray[i][1] = chartDataArray[i];
        dataArray[i][2] = dataValueAsInt;
        dataArray[i][3] = chartBgColorArray[i];

        var rowContent = 'data.addRow([chartLabelArray[i], {v: ' + dataValueAsInt + ', f: "' + chartDataArray[i] + '"}, {v: "' + chartBgColorArray[i] + '", f: null, p: {style: "background-color: ' + chartBgColorArray[i] + ';"}}]);';
        eval(rowContent);
      }
      var table = new google.visualization.Table(tableDivId);
      table.draw(data, {showRowNumber: false, width: '100%', height: '100%', allowHtml: true});
 
      var chart1 = new google.visualization.PieChart(chart1DivId);
      chart1.draw(data, {
          width: '800', 
          height: '450',
          colors: chartBgColorArray,
          is3D: true,
          chartArea: {
            height: '96%'
          },
          legend: {
            textStyle: {
              fontSize: 9
            }
          }
      });

      // Prepare and display download buttons
      var csvContent = google.visualization.dataTableToCsv(data);
      var csvData = new Blob([csvContent]);
      buttonsDivId.innerHTML = '<a href=\"' + chart1.getImageURI() + '\" download=\"chart.png\"> <button type=\"button\">\&\#8681\; .png</button></a>' + '<a href=\"' + URL.createObjectURL(csvData) + '\" download=\"data.csv\" type=\"text/csv\"><button type=\"button\">\&\#8681\; .csv</button></a>';

      return dataArray;
    }

    function printSmallListAsTable(textContent, mainREGEX, subREGEX1, subREGEX2, subREGEX3, subREGEX4, subREGEX5, target, tableHeader) {
      listContent = listSmallDataTransform(textContent, mainREGEX, subREGEX1, subREGEX2, subREGEX3, subREGEX4, subREGEX5);
      listContentLineArray = listContent.split(';');

      var data = new google.visualization.DataTable();

      tableDivId = document.getElementById(target + '_result');
      buttonsDivId = document.getElementById(target + '_buttons');

      headersArray = tableHeader.split(',');
      for (var i = 0; i < headersArray.length; i++) {
        data.addColumn('string', headersArray[i]);
      }

      for (var i = 0; i < listContentLineArray.length-1; i++) {        
        listContentElementArray = listContentLineArray[i].split(',');
        var rowContent = "";
        for (var j = 0; j < listContentElementArray.length; j++) {
          cleanVar = listContentElementArray[j].replace(/\<br\>|\'/g, '');
          if (rowContent) {
            rowContent += ", '" + cleanVar + "'";
          } else {
            rowContent = "data.addRow(['" + cleanVar + "'";
          }
        }
        rowContent += "]);";
        eval(rowContent);
      }
      var table = new google.visualization.Table(tableDivId);
      table.draw(data, {showRowNumber: false, width: '100%', height: '100%', allowHtml: true});

      // Prepare and display download buttons
      var csvContent = google.visualization.dataTableToCsv(data);
      var csvData = new Blob([csvContent]);
      buttonsDivId.innerHTML = '<a href=\"' + URL.createObjectURL(csvData) + '\" download=\"data.csv\" type=\"text/csv\"><button type=\"button\">\&\#8681\; .csv</button></a>';

    }

    function printBigListAsTable(textContent, arrayNamesText, mainREGEX, subREGEX2, subREGEX3, subREGEX4, subREGEX5, target, tableHeader) {
      arrayNames = arrayNamesText.split(',');

      for (var i = 0; i < arrayNames.length; i++) {
        var subREGEX1 = new RegExp(arrayNames[i] + '\=\{[\\s\\S]*?\}', "");
        listContent = listBigDataTransform(textContent, mainREGEX, subREGEX1, subREGEX2, subREGEX3, subREGEX4, subREGEX5);
        listContentLineArray[i] = listContent.split(',');
      }

      var data = new google.visualization.DataTable();

      tableDivId = document.getElementById(target + '_result');
      buttonsDivId = document.getElementById(target + '_buttons');

      headersArray = tableHeader.split(',');
      for (var i = 0; i < headersArray.length; i++) {
        data.addColumn('string', headersArray[i]);
      }

        for (var j = 0; j < listContentLineArray[0].length; j++) {
        var rowContent = "";
          for (var k = 0; k < headersArray.length; k++) {
            cleanVar = listContentLineArray[k][j].replace(/\<br\>|\'/g, '');
            if (rowContent) {
              rowContent += ", '" + cleanVar + "'";
            } else {
              rowContent = "data.addRow(['" + cleanVar + "'";
            }
          }
        rowContent += "]);";
        eval(rowContent);
        }

      var table = new google.visualization.Table(tableDivId);
      table.draw(data, {showRowNumber: true, width: '100%', height: '100%', allowHtml: true});

      // Prepare and display download buttons
      var csvContent = google.visualization.dataTableToCsv(data);
      var csvData = new Blob([csvContent]);
      buttonsDivId.innerHTML = '<a href=\"' + URL.createObjectURL(csvData) + '\" download=\"data.csv\" type=\"text/csv\"><button type=\"button\">\&\#8681\; .csv</button></a>';
    }

    function printListAsTable(textContent, matchNo, mainREGEX, subREGEX1, subREGEX2, subREGEX3, subREGEX4, subREGEX5, subREGEX6, target, tableHeader) {
      listContent = listDataTransform(textContent, matchNo, mainREGEX, subREGEX1, subREGEX2, subREGEX3, subREGEX4, subREGEX5, subREGEX6);
      listContentLineArray = listContent.split(';');

      var data = new google.visualization.DataTable();

      tableDivId = document.getElementById(target + '_result');
      buttonsDivId = document.getElementById(target + '_buttons');
 
      headersArray = tableHeader.split(',');
      for (var i = 0; i < headersArray.length; i++) {
        data.addColumn('string', headersArray[i]);
      }

      for (var i = 0; i < listContentLineArray.length-1; i++) {
        listContentElementArray = listContentLineArray[i].split(',');
        var rowContent = "";
        for (var j = 0; j < listContentElementArray.length; j++) {
          cleanVar = listContentElementArray[j].replace(/\<br\>|\'/g, '');
          if (rowContent) {
            rowContent += ", '" + cleanVar + "'";
          } else {
            rowContent = "data.addRow(['" + cleanVar + "'";
          }
        }
        rowContent += "]);";
        eval(rowContent);
      }
      var table = new google.visualization.Table(tableDivId);
      table.draw(data, {showRowNumber: false, width: '100%', height: '100%', allowHtml: true});

      // Prepare and display download buttons
      var csvContent = google.visualization.dataTableToCsv(data);
      var csvData = new Blob([csvContent]);
      buttonsDivId.innerHTML = '<a href=\"' + URL.createObjectURL(csvData) + '\" download=\"data.csv\" type=\"text/csv\"><button type=\"button\">\&\#8681\; .csv</button></a>';
    }

    function printComboChart(dataArray1, dataArray2, target) {
      if (dataArray1 !== null && dataArray2 !== null && typeof dataArray1 !== 'undefined' && typeof dataArray2 !== 'undefined') {
      chartDivId = document.getElementById(target + '_chart');
      buttonsDivId = document.getElementById(target + '_buttons');

        var kit1name = document.getElementById('kit1_name');
        var kit1date = document.getElementById('kit1_date');
        var kit2name = document.getElementById('kit2_name');
        var kit2date = document.getElementById('kit2_date');
        var chartData = "['Name','" + kit1name.textContent + "-" + kit1date.textContent + "', '" + kit2name.textContent + "-" + kit2date.textContent + "']";
        var row = "";

        var foundInData1 = [];
        for (var i = 0; i < dataArray1.length; i++) {
          var foundData2Match = false;
          for (var j = 0; j < dataArray2.length; j++) {
            if ( dataArray2[j].includes(dataArray1[i][0]) && (foundData2Match == false)) {
              const matchingData = (element) => element == dataArray1[i][0];
              var data2index = dataArray2[j].findIndex(matchingData);
              chartData += ",['" + dataArray1[i][0] + "', " + dataArray1[i][2] / 100 + ", " + dataArray2[j][2] / 100 + "]";
              foundData2Match = true;
              foundInData1[j] = true;
            }
          }
          if ( foundData2Match == false ) {
             chartData += ",['" + dataArray1[i][0] + "', " + dataArray1[i][2] / 100 + ", 0]";          
          }
        }
        for (var i = 0; i < dataArray2.length; i++) {
          if (foundInData1[i] == null || typeof foundInData1[i] == 'undefined') {
            chartData += ",['" + dataArray2[i][0] + "', 0, " + dataArray2[i][2] / 100 + "]";
          }
        }
      
        eval ("var data = google.visualization.arrayToDataTable([" + chartData + "])");

            var options = {
               orientation:'vertical',
               vAxis: { showTextEvery:1 },
               seriesType: 'bars',
               width: '900',
               height: '650',
               fontSize: 11,
               chartArea: {
                 height: '86%'
               },
            };

            var chart = new google.visualization.ComboChart(chartDivId);
            chart.draw(data, options);

      // Prepare and display download buttons
      buttonsDivId.innerHTML = '<a href=\"' + chart.getImageURI() + '\" download=\"chart.png\"> <button type=\"button\">\&\#8681\; .png</button></a>'

      }
    }
 
    async function openFileFunction(event,col) {
      // define arrays
      var arrayAsb = [];
      var arrayDd = [];
      var arrayYdna = [];
      var arrayMtdna = [];

      for (let el of document.querySelectorAll('.header')) el.style.display = 'block';
      document.getElementById('viewOptionsButton').disabled = false;
      const selectedFile = event.target.files.item(0);
      textContent = await selectedFile.text();

      // Get Kit info from html text
      if (col == 1) {
        kitDivInfo="kit1";
      } else {
        kitDivInfo="kit2";
      }
      mainREGEXkit=/Kit\:.*show.*\<\/a\>/;
      subREGEX1kit=/.*id\=\"name|\ onclick[\s\S]*?\>|\<\/a\>/g;
      var kitNumber = getKitData(textContent, kitDivInfo, mainREGEXkit, subREGEX1kit);
      getKitDate(textContent, kitNumber, kitDivInfo);

      // Get ASB, DD, Y-DNA and mtDNA data from html text
      var mainREGEXasb = new RegExp('refreshFunctionChartAncient' + kitNumber + '\\(jobid\\) \\{[\\s\\S]*?\\}', "g");
      var mainREGEXdd =  new RegExp('refreshFunctionChartDDAncient' + kitNumber + '\\(jobid\\) \{[\\s\\S]*?\\}', "g");
      var mainREGEXydna = new RegExp('refreshFunctionChart' + kitNumber + '\\(job[\\s\\S]*?options', "g");
      var mainREGEXmtdna = new RegExp('\\#pieChartYData' + kitNumber + '[\\s\\S]*?document.getElementById\\(\\"pieChartX[\\s\\S]*?\\{[\\s\\S]*?\\}', "g");
      subREGEX1=/labels[\s\S]*?\]/g;
      subREGEX2=/data[\s\S]*?\]/g;
      subREGEX3=/backgroundColor[\s\S]*?\]/g;

      // Print Charts and Tables
      if (col == 1) {
        arrayAsb1 = printChartAsTable(textContent, mainREGEXasb, subREGEX1, subREGEX2, subREGEX3, "asb", col);
        arrayDd1 = printChartAsTable(textContent, mainREGEXdd, subREGEX1, subREGEX2, subREGEX3, "dd", col);
        arrayYdna1 = printChartAsTable(textContent, mainREGEXydna, subREGEX1, subREGEX2, subREGEX3, "ydna", col);
        arrayMtdna1 = printChartAsTable(textContent, mainREGEXmtdna, subREGEX1, subREGEX2, subREGEX3, "mtdna", col);
      } else {
        arrayAsb2 = printChartAsTable(textContent, mainREGEXasb, subREGEX1, subREGEX2, subREGEX3, "asb", col);
        arrayDd2 = printChartAsTable(textContent, mainREGEXdd, subREGEX1, subREGEX2, subREGEX3, "dd", col);
        arrayYdna2 = printChartAsTable(textContent, mainREGEXydna, subREGEX1, subREGEX2, subREGEX3, "ydna", col);
        arrayMtdna2 = printChartAsTable(textContent, mainREGEXmtdna, subREGEX1, subREGEX2, subREGEX3, "mtdna", col);
      } 

      // Print Comparison Charts and Tables
      printComboChart (arrayAsb1, arrayAsb2, "asb_combo");
      printComboChart (arrayDd1, arrayDd2, "dd_combo");
      printComboChart (arrayYdna1, arrayYdna2, "ydna_combo");
      printComboChart (arrayMtdna1, arrayMtdna2, "mtdna_combo");

      var mainREGEXsm = new RegExp('refreshFunctionGlobeHaplo' + kitNumber + '\\(samplemax\\) \\{[\\s\\S]*?\]\\;', "g");
      subREGEX1sm=/title[\s\S]*?\,/g;
      subREGEX2sm=/title\"\:\s?\"Sample\s?match\s?\#/g;
      subREGEX3sm=/\"\,\,|\"\,/g;
      subREGEX4sm=/Y-DNA\:\s?|mtDNA\:\s?|Age\:\s?|Genetic\s?Distance\:\s?|Archaeological\s?ID\:\s?/g;
      subREGEX5sm=/\r*|\n*/g;
      subREGEX6sm=/\:/g;
      smMatchNo=0;
      smTableHeader="No,Name,Y-DNA,mtDNA,Age,GD,Arch ID";

      mainREGEXddar=/dataDD\=\[[\s\S]*?\]\;/g;
      subREGEX1ddar=/title[\s\S]*?\,/g;;
      subREGEX2ddar=/title\"\:\s?\"Deep\s?Dive\s?match\:/g;
      subREGEX3ddar=/\"\,\,|\"\,/g;
      subREGEX4ddar=/Y-DNA\:\s?|mtDNA\:\s?|Age\:\s?|Longest\s?Shared\s?DNA\:\s?|Archaeological\s?ID\:\s?/g;
      subREGEX5ddar=/\r*|\n*/g;
      subREGEX6ddar=/\:/g;
      ddarMatchNo=1;
      ddarTableHeader="Name,Y-DNA,mtDNA,Age,Longest Shared DNA,Arch ID";

      mainREGEXcmod=/Your\s?closest\s?genetic\s?modern[\s\S]*?\<hr\>/;
      subREGEX1cmod=/Your\s?closest[\s\S]*?\<\/a\>|\<hr\>|\<br\>|\n/g;
      subREGEX2cmod=/\)/g;
      subREGEX3cmod=/\s+\(/g;
      subREGEX4cmod=/\_/g;
      subREGEX5cmod=/\(|^,|,$/g;
      cmodTableHeader="Name,GD";

      mainREGEXcanc=/Your\s?closest\s?Ancient\s?populations[\s\S]*?\<a/;
      subREGEX1canc=/Your\s?closest[\s\S]*?\<\/div\>\<\/div\>\<hr\>|\<br\>|\<\/font\>|\<font\s?color\=\"[\S]{6}\"\>|\<a|\n/g;
      subREGEX2canc=/\)/g;
      subREGEX3canc=/\s+\(/g;
      subREGEX4canc=/\_/g;
      subREGEX5canc=/\(|^,|,$|\s+/g;
      cancTableHeader="Name,GD";

      var mainREGEXhaploExp = new RegExp('document.getElementById\\(\\"nav-haploexpYdd-tab' + kitNumber + '[\\s\\S]*?function processData\\(data\\) \\{', "");
      arrayListHaploExp = 'name_map,age_map,score_map,arch_map,y_map,x_map';
      haploExpHeader = "Name,Age,Score,Arch,Y-DNA,mtDNA";
      subREGEXhaploExp2 = /\}\;[\s\S]*?/g; // to remove
      subREGEXhaploExp3 = /Y-DNA\:\s?|mtDNA\:\s?|[\S]*?\"\:\"/g; // to remove
      subREGEXhaploExp4 = /\"|\}/g; // to remove
      subREGEXhaploExp5 = /\,\s*/g; // to replace with comma
       

      if (col == 1) {
        printSmallListAsTable(textContent, mainREGEXcanc, subREGEX1canc, subREGEX2canc, subREGEX3canc, subREGEX4canc, subREGEX5canc, "canc1", cancTableHeader);
        printSmallListAsTable(textContent, mainREGEXcmod, subREGEX1cmod, subREGEX2cmod, subREGEX3cmod, subREGEX4cmod, subREGEX5cmod, "cmod1", cmodTableHeader);
        printListAsTable(textContent, smMatchNo, mainREGEXsm, subREGEX1sm, subREGEX2sm, subREGEX3sm, subREGEX4sm, subREGEX5sm, subREGEX6sm, "sm1", smTableHeader);
        printListAsTable(textContent, ddarMatchNo, mainREGEXddar, subREGEX1ddar, subREGEX2ddar, subREGEX3ddar, subREGEX4ddar, subREGEX5ddar, subREGEX6ddar, "ddar1", ddarTableHeader);
        printBigListAsTable(textContent, arrayListHaploExp, mainREGEXhaploExp, subREGEXhaploExp2, subREGEXhaploExp3, subREGEXhaploExp4, subREGEXhaploExp5, "haploexp1", haploExpHeader);
      } else {
        printSmallListAsTable(textContent, mainREGEXcanc, subREGEX1canc, subREGEX2canc, subREGEX3canc, subREGEX4canc, subREGEX5canc, "canc2", cancTableHeader);
        printSmallListAsTable(textContent, mainREGEXcmod, subREGEX1cmod, subREGEX2cmod, subREGEX3cmod, subREGEX4cmod, subREGEX5cmod, "cmod2", cmodTableHeader);
        printListAsTable(textContent, smMatchNo, mainREGEXsm, subREGEX1sm, subREGEX2sm, subREGEX3sm, subREGEX4sm, subREGEX5sm, subREGEX6sm, "sm2", smTableHeader);
        printListAsTable(textContent, ddarMatchNo, mainREGEXddar, subREGEX1ddar, subREGEX2ddar, subREGEX3ddar, subREGEX4ddar, subREGEX5ddar, subREGEX6ddar, "ddar2", ddarTableHeader);
        printBigListAsTable(textContent, arrayListHaploExp, mainREGEXhaploExp, subREGEXhaploExp2, subREGEXhaploExp3, subREGEXhaploExp4, subREGEXhaploExp5, "haploexp2", haploExpHeader);
      }
    }

   </script>

  <div class="row">
    <div class="column">
      <input type="file" class="input_button" style="width:400" ACCEPT="text/html" onchange="openFileFunction(event,1)" />
    </div>
    <div class="column">
      <input type="file" class="input_button" style="width:400" ACCEPT="text/html" onchange="openFileFunction(event,2)" />
    </div>
  </div>
  <div class="row">
    <div class="column">
      <p class="header" style="display:none">Kit: [<b id="kit1_number"></b>] <b id="kit1_name"></b> (<b id="kit1_date"></b>)</p>
    </div>
    <div class="column">
      <p class="header" style="display:none">Kit: [<b id="kit2_number"></b>] <b id="kit2_name"></b> (<b id="kit2_date"></b>)</p>
    </div>
  </div>


  <div class="asb-block">
    <div class="row" id="asb">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">Ancient Samples Full Breakdown</h3>
      <div class="column">
        <div id="asb1_buttons" class="dl-button"></div>
        <div id="asb1_chart1" class="result-chart"></div>
        <div id="asb1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="asb2_buttons" class="dl-button"></div>
        <div id="asb2_chart1" class="result-chart"></div>
        <div id="asb2_result" class="result-table"></div>
      </div>
    </div>
    <div class="comparison-row" id="asb_combo">
        <div id="asb_combo_buttons" class="dl-button"></div>
        <div id="asb_combo_chart"></div>
        <div id="asb_combo_result"></div>
    </div>
  </div>

  <div class="dd-block">
    <div class="row" id="dd">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">Deep Dive Full Breakdown</h3>
      <div class="column">
        <div id="dd1_buttons" class="dl-button"></div>
        <div id="dd1_chart1" class="result-chart"></div>
        <div id="dd1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="dd2_buttons" class="dl-button"></div>
        <div id="dd2_chart1" class="result-chart"></div>
        <div id="dd2_result" class="result-table"></div>
      </div>
    </div>
    <div class="comparison-row" id="dd_combo">
        <div id="dd_combo_buttons" class="dl-button"></div>
        <div id="dd_combo_chart"></div>
        <div id="dd_combo_result"></div>
    </div>
  </div>

  <div class="canc-block">
    <div class="row" id="canc">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">Closest Ancient Populations</h3>
      <div class="column">
        <div id="canc1_buttons" class="dl-button"></div>
        <div id="canc1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="canc2_buttons" class="dl-button"></div>
        <div id="canc2_result" class="result-table"></div>
      </div>
    </div>
  </div>

  <div class="cmod-block">
    <div class="row" id="cmod">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">Closest Modern Populations</h3>
      <div class="column">
        <div id="cmod1_buttons" class="dl-button"></div>
        <div id="cmod1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="cmod2_buttons" class="dl-button"></div>
        <div id="cmod2_result" class="result-table"></div>
      </div>
    </div>
  </div>

  <div class="ydna-block">
    <div class="row" id="ydna">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">Y-DNA Breakdown</h3>
      <div class="column">
        <div id="ydna1_buttons" class="dl-button"></div>
        <div id="ydna1_chart1" class="result-chart"></div>
        <div id="ydna1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="ydna2_buttons" class="dl-button"></div>
        <div id="ydna2_chart1" class="result-chart"></div>
        <div id="ydna2_result" class="result-table"></div>
      </div>
    </div>
    <div class="comparison-row" id="ydna_combo">
        <div id="ydna_combo_buttons" class="dl-button"></div>
        <div id="ydna_combo_chart"></div>
        <div id="ydna_combo_result"></div>
    </div>
  </div>

  <div class="mtdna-block">
    <div class="row" id="mtdna">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">mtDNA Breakdown</h3>
      <div class="column">
        <div id="mtdna1_buttons" class="dl-button"></div>
        <div id="mtdna1_chart1" class="result-chart"></div>
        <div id="mtdna1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="mtdna2_buttons" class="dl-button"></div>
        <div id="mtdna2_chart1" class="result-chart"></div>
        <div id="mtdna2_result" class="result-table"></div>
      </div>
    </div>
    <div class="comparison-row" id="mtdna_combo">
        <div id="mtdna_combo_buttons" class="dl-button"></div>
        <div id="mtdna_combo_chart"></div>
        <div id="mtdna_combo_result"></div>
    </div>
  </div>

  <div class="sm-block">
    <div class="row" id="sm">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">The Closest Archaeogenetic matches</h3>
      <div class="column">
        <div id="sm1_buttons" class="dl-button"></div>
        <div id="sm1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="sm2_buttons" class="dl-button"></div>
        <div id="sm2_result" class="result-table"></div>
      </div>
    </div>
  </div>

  <div class="ddar-block">
    <div class="row" id="ddar">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">Deep Dive - Ancient Relatives</h3>
      <div class="column">
        <div id="ddar1_buttons" class="dl-button"></div>
        <div id="ddar1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="ddar2_buttons" class="dl-button"></div>
        <div id="ddar2_result" class="result-table"></div>
      </div>
    </div>
  </div>

  <div class="haploexp-block">
    <div class="row" id="haploexp">
      <hr class="header" style="display:none">
      <h3 class="header" style="display:none">All Samples</h3>
      <div class="column">
        <div id="haploexp1_buttons" class="dl-button"></div>
        <div id="haploexp1_result" class="result-table"></div>
      </div>
      <div class="column">
        <div id="haploexp2_buttons" class="dl-button"></div>
        <div id="haploexp2_result" class="result-table"></div>
      </div>
    </div>
  </div>

   </body>
</html>
